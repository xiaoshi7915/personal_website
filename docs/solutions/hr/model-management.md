# 4. 模型与提示词管理

## 4.1 多模型路由

### 模型选择策略

智能人力资源系统需要支持多个AI模型，根据不同HR场景选择最优模型：

#### 模型池配置

**简历解析模型**：
- **BERT-base**：通用文本理解模型，适合简历文本解析
- **RoBERTa**：优化的BERT模型，准确率更高
- **中文BERT**：中文优化的BERT模型，适合中文简历解析
- **简历专用模型**：针对简历场景训练的专用模型

**人才匹配模型**：
- **向量检索模型**：基于Transformer的向量检索模型，适合人才匹配
- **协同过滤模型**：基于协同过滤的推荐模型，适合相似人才推荐
- **知识图谱模型**：基于知识图谱的匹配模型，适合复杂匹配场景

**面试问题生成模型**：
- **GPT-4**：通用大语言模型，理解能力强，适合复杂问题生成
- **中文大模型**：如ChatGLM3-6B、Qwen-7B等中文大模型
- **面试专用模型**：针对面试场景训练的专用模型

**培训推荐模型**：
- **推荐算法**：基于协同过滤、内容推荐的推荐模型
- **知识图谱模型**：基于知识图谱的推荐模型
- **深度学习推荐模型**：基于深度学习的推荐模型

**绩效分析模型**：
- **回归模型**：用于绩效预测的回归模型
- **分类模型**：用于绩效分类的分类模型
- **聚类模型**：用于绩效分组的聚类模型

**模型选择矩阵**：

| 场景 | 推荐模型 | 原因 |
|------|---------|------|
| 简历解析 | 中文BERT | 中文优化，准确率高 |
| 人才匹配 | 向量检索模型 | 匹配速度快，准确率高 |
| 面试问题生成 | GPT-4 | 理解能力强，问题质量高 |
| 培训推荐 | 知识图谱模型 | 考虑技能关联，推荐准确 |
| 绩效分析 | 回归模型 | 预测准确，解释性强 |

#### 选择策略实现

**基于任务类型**：
```python
def select_model_by_task(task_type: str, language: str):
    """根据任务类型选择模型"""
    model_map = {
        ('resume_parsing', 'zh'): 'chinese-bert-resume',
        ('talent_matching', 'any'): 'vector-search-model',
        ('interview_question', 'zh'): 'gpt-4-chinese',
        ('training_recommend', 'any'): 'knowledge-graph-recommend',
        ('performance_analysis', 'any'): 'regression-model',
    }
    
    key = (task_type, language)
    return model_map.get(key, 'default-model')
```

**基于准确率要求**：
```python
def select_model_by_accuracy_requirement(required_accuracy: float):
    """根据准确率要求选择模型"""
    if required_accuracy >= 0.95:
        return 'premium-model'  # 高准确率模型
    elif required_accuracy >= 0.90:
        return 'standard-model'  # 标准模型
    else:
        return 'fast-model'  # 快速模型
```

**基于成本优化**：
```python
def select_model_by_cost_budget(budget: float, task_complexity: float):
    """根据成本预算选择模型"""
    if budget > 1.0 and task_complexity > 0.8:
        return 'premium-model'  # 高预算复杂任务
    elif budget > 0.5:
        return 'standard-model'  # 中等预算
    else:
        return 'fast-model'  # 低预算
```

### 模型路由实现

#### 路由策略

**基于请求特征路由**：
```python
class ModelRouter:
    """模型路由器"""
    
    def route(self, request: Dict) -> str:
        """路由请求到合适的模型"""
        task_type = request.get('task_type')
        language = request.get('language', 'zh')
        accuracy_requirement = request.get('accuracy_requirement', 0.90)
        cost_budget = request.get('cost_budget', 0.5)
        
        # 首先根据任务类型选择
        model = select_model_by_task(task_type, language)
        
        # 然后根据准确率要求调整
        if get_model_accuracy(model) < accuracy_requirement:
            model = select_model_by_accuracy_requirement(accuracy_requirement)
        
        # 最后根据成本预算调整
        if get_model_cost(model) > cost_budget:
            model = select_model_by_cost_budget(cost_budget, 0.5)
        
        return model
```

#### 负载均衡

**模型实例负载均衡**：
- **轮询**：轮询分配请求到不同模型实例
- **加权轮询**：根据模型性能加权分配请求
- **最少连接**：分配请求到连接数最少的模型实例

## 4.2 提示词管理

### 提示词模板

#### 简历解析提示词

**基础模板**：
```
你是一个专业的HR助手，请解析以下简历，提取关键信息：

简历内容：
{resume_text}

请提取以下信息：
1. 基本信息：姓名、性别、年龄、联系方式
2. 教育背景：学历、学校、专业、毕业时间
3. 工作经历：公司、职位、工作时间、工作内容
4. 技能：专业技能、语言能力、证书等
5. 项目经验：项目名称、项目描述、项目成果

请以JSON格式返回结果。
```

**增强模板**（包含示例）：
```
你是一个专业的HR助手，请解析以下简历，提取关键信息。

简历内容：
{resume_text}

请提取以下信息：
1. 基本信息：姓名、性别、年龄、联系方式
2. 教育背景：学历、学校、专业、毕业时间
3. 工作经历：公司、职位、工作时间、工作内容
4. 技能：专业技能、语言能力、证书等
5. 项目经验：项目名称、项目描述、项目成果

示例输出：
{
  "basic_info": {
    "name": "张三",
    "gender": "男",
    "age": 30,
    "contact": "13800138000"
  },
  "education": [
    {
      "degree": "本科",
      "school": "清华大学",
      "major": "计算机科学",
      "graduation_time": "2015年"
    }
  ],
  "work_experience": [
    {
      "company": "阿里巴巴",
      "position": "高级工程师",
      "duration": "2015-2020",
      "description": "负责核心系统开发"
    }
  ],
  "skills": ["Java", "Python", "Spring"],
  "projects": [
    {
      "name": "电商系统",
      "description": "大型电商平台开发",
      "achievement": "日活用户100万"
    }
  ]
}

请按照示例格式返回结果。
```

#### 人才匹配提示词

**基础模板**：
```
你是一个专业的HR助手，请评估候选人与岗位的匹配度。

岗位要求：
{job_requirements}

候选人简历：
{candidate_resume}

请评估以下方面：
1. 技能匹配度（0-100分）
2. 经验匹配度（0-100分）
3. 学历匹配度（0-100分）
4. 综合匹配度（0-100分）
5. 匹配理由

请以JSON格式返回结果。
```

#### 面试问题生成提示词

**基础模板**：
```
你是一个专业的HR助手，请为以下候选人生成面试问题。

岗位：{job_title}
岗位要求：{job_requirements}
候选人简历：{candidate_resume}

请生成以下类型的面试问题：
1. 技术问题（3-5个）
2. 行为问题（3-5个）
3. 情景问题（2-3个）

每个问题应包括：
- 问题内容
- 评估要点
- 参考答案

请以JSON格式返回结果。
```

### 提示词版本管理

#### 版本控制

**版本命名规则**：
- **主版本号**：重大变更（如提示词结构变化）
- **次版本号**：功能增强（如新增字段）
- **修订版本号**：bug修复或小幅优化

**版本示例**：
- v1.0.0：初始版本
- v1.1.0：新增技能评估字段
- v1.1.1：修复格式错误

#### 版本管理流程

1. **提示词开发**：在开发环境开发新版本提示词
2. **测试验证**：在测试环境测试新版本提示词
3. **版本发布**：发布新版本提示词到生产环境
4. **版本回滚**：如果新版本有问题，回滚到旧版本

### 提示词优化

#### A/B测试

**测试流程**：
1. **创建变体**：创建提示词变体（A版本和B版本）
2. **流量分配**：将流量分配到不同版本（如50%:50%）
3. **数据收集**：收集各版本的效果数据
4. **效果评估**：评估各版本的效果
5. **选择最优**：选择效果最好的版本

**评估指标**：
- **准确率**：解析准确率、匹配准确率等
- **响应时间**：模型响应时间
- **用户满意度**：用户满意度评分

#### 持续优化

**优化策略**：
- **数据分析**：分析提示词效果数据，找出问题
- **用户反馈**：收集用户反馈，了解改进方向
- **最佳实践**：参考行业最佳实践，优化提示词
- **迭代改进**：持续迭代改进提示词

## 4.3 模型监控与评估

### 模型性能监控

#### 监控指标

**准确率指标**：
- **简历解析准确率**：简历信息提取准确率
- **人才匹配准确率**：人才匹配准确率
- **面试问题质量**：面试问题质量评分
- **培训推荐准确率**：培训推荐准确率
- **绩效分析准确率**：绩效分析准确率

**性能指标**：
- **响应时间**：模型响应时间（P50、P95、P99）
- **吞吐量**：每秒处理的请求数
- **错误率**：模型错误率

**成本指标**：
- **API调用成本**：API调用费用
- **计算资源成本**：GPU/CPU使用成本
- **存储成本**：模型存储成本

#### 监控告警

**告警规则**：
- **准确率下降**：准确率下降超过5%时告警
- **响应时间增加**：响应时间增加超过50%时告警
- **错误率上升**：错误率超过1%时告警
- **成本异常**：成本异常增加时告警

### 模型评估

#### 评估方法

**离线评估**：
- **测试集评估**：在测试集上评估模型性能
- **交叉验证**：使用交叉验证评估模型稳定性
- **A/B测试**：通过A/B测试评估模型效果

**在线评估**：
- **实时监控**：实时监控模型性能
- **用户反馈**：收集用户反馈，评估模型效果
- **业务指标**：通过业务指标评估模型价值

#### 评估报告

**报告内容**：
- **性能指标**：准确率、响应时间、错误率等
- **成本分析**：API成本、计算资源成本等
- **问题分析**：发现的问题和改进建议
- **优化建议**：模型优化建议

